{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
  .password-field-wrapper { position: relative; }
  .toggle-pass {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: 0;
    padding: 4px;
    cursor: pointer;
    color: var(--body-quiet-color, #666);
  }
  .toggle-pass svg { width: 20px; height: 20px; display: block; }
  .toggle-pass:focus { outline: 2px solid #2684FF; outline-offset: 2px; border-radius: 4px; }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
  {% if form.errors and not form.non_field_errors %}
    <p class="errornote">{% trans "Please enter the correct username and password for a staff account. Note that both fields may be case-sensitive." %}</p>
  {% endif %}
  {% if form.non_field_errors %}
    {% for error in form.non_field_errors %}
      <p class="errornote">{{ error }}</p>
    {% endfor %}
  {% endif %}

  <form action="{% url 'admin:login' %}" method="post" id="login-form" novalidate>
    {% csrf_token %}
    <div class="form-row">
      {{ form.username.errors }}
      <label for="id_username">{% trans 'Username' %}:</label>
      {{ form.username }}
    </div>

    <div class="form-row password-field-wrapper">
      {{ form.password.errors }}
      <label for="id_password">{% trans 'Password' %}:</label>
      {{ form.password }}
      <button type="button" id="toggle-password" class="toggle-pass" aria-label="{% trans 'Toggle password visibility' %}" aria-pressed="false">
        <span class="icon-eye" aria-hidden="true">
          <!-- Eye icon -->
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
          </svg>
        </span>
        <span class="icon-eye-off" aria-hidden="true" style="display:none">
          <!-- Eye-off icon -->
          <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M17.94 17.94C16.23 19 14.2 19.64 12 19.64 5 19.64 1 12 1 12c.76-1.3 1.69-2.46 2.75-3.44M9.9 4.26C10.58 4.1 11.28 4 12 4c7 0 11 8 11 8-.58.99-1.27 1.9-2.06 2.7M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </span>
      </button>
    </div>

    <div class="submit-row">
      {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}
      <button type="submit" class="default">{% trans 'Log in' %}</button>
    </div>
  </form>
</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
  (function() {
    const btn = document.getElementById('toggle-password');
    if (!btn) return;
    const input = document.getElementById('id_password');
    if (!input) return;
    const eye = btn.querySelector('.icon-eye');
    const eyeOff = btn.querySelector('.icon-eye-off');
    btn.addEventListener('click', function() {
      const isPassword = input.getAttribute('type') === 'password';
      input.setAttribute('type', isPassword ? 'text' : 'password');
      if (eye && eyeOff) {
        eye.style.display = isPassword ? 'none' : '';
        eyeOff.style.display = isPassword ? '' : 'none';
      }
      btn.setAttribute('aria-pressed', isPassword ? 'true' : 'false');
    });
  })();
</script>
{% endblock %}
