{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block extrastyle %}
{{ block.super }}
<style>
  .password-field-wrapper { position: relative; }
  .toggle-pass {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    background: transparent;
    border: 0;
    padding: 4px;
    cursor: pointer;
    color: var(--body-quiet-color, #666);
  }
  .toggle-pass svg { width: 20px; height: 20px; display: block; }
  .toggle-pass:focus { outline: 2px solid #2684FF; outline-offset: 2px; border-radius: 4px; }
</style>
{% endblock %}

{% block content %}
<div id="content-main">
  <h1>{% blocktrans with username=original %}Change password: {{ username }}{% endblocktrans %}</h1>

  <form action="" method="post" id="change-password-form">
    {% csrf_token %}

    {% if form.errors %}
      <p class="errornote">{% trans "Please correct the error below." %}</p>
    {% endif %}

    <div class="module aligned">
      <div class="form-row">
        {{ form.password1.errors }}
        <label for="id_password1" class="required">{% trans 'Password' %}:</label>
        <div class="password-field-wrapper">
          {{ form.password1 }}
          <button type="button" class="toggle-pass" data-target="id_password1" aria-label="{% trans 'Toggle password visibility' %}" aria-pressed="false">
            <span class="icon-eye" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
            <span class="icon-eye-off" aria-hidden="true" style="display:none">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.94 17.94C16.23 19 14.2 19.64 12 19.64 5 19.64 1 12 1 12c.76-1.3 1.69-2.46 2.75-3.44M9.9 4.26C10.58 4.1 11.28 4 12 4c7 0 11 8 11 8-.58.99-1.27 1.9-2.06 2.7M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </button>
        </div>
        {% if form.password1.help_text %}<div class="help">{{ form.password1.help_text|safe }}</div>{% endif %}
      </div>

      <div class="form-row">
        {{ form.password2.errors }}
        <label for="id_password2" class="required">{% trans 'Password (again)' %}:</label>
        <div class="password-field-wrapper">
          {{ form.password2 }}
          <button type="button" class="toggle-pass" data-target="id_password2" aria-label="{% trans 'Toggle password visibility' %}" aria-pressed="false">
            <span class="icon-eye" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7S1 12 1 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                <circle cx="12" cy="12" r="3" stroke="currentColor" stroke-width="2"/>
              </svg>
            </span>
            <span class="icon-eye-off" aria-hidden="true" style="display:none">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M17.94 17.94C16.23 19 14.2 19.64 12 19.64 5 19.64 1 12 1 12c.76-1.3 1.69-2.46 2.75-3.44M9.9 4.26C10.58 4.1 11.28 4 12 4c7 0 11 8 11 8-.58.99-1.27 1.9-2.06 2.7M1 1l22 22" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </span>
          </button>
        </div>
      </div>
    </div>

    <div class="submit-row">
      <input type="submit" value="{% trans 'Change password' %}" class="default">
    </div>
  </form>
</div>
{% endblock %}

{% block extrahead %}
{{ block.super }}
<script>
  (function() {
    function setup(btn){
      const inputId = btn.getAttribute('data-target');
      const input = document.getElementById(inputId);
      if (!input) return;
      const eye = btn.querySelector('.icon-eye');
      const eyeOff = btn.querySelector('.icon-eye-off');
      btn.addEventListener('click', function() {
        const isPassword = input.getAttribute('type') === 'password';
        input.setAttribute('type', isPassword ? 'text' : 'password');
        if (eye && eyeOff) {
          eye.style.display = isPassword ? 'none' : '';
          eyeOff.style.display = isPassword ? '' : 'none';
        }
        btn.setAttribute('aria-pressed', isPassword ? 'true' : 'false');
      });
    }
    document.querySelectorAll('.toggle-pass').forEach(setup);
  })();
</script>
{% endblock %}
